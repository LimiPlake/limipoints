<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>LimiPlake PIN Picker</title>
<style>
  :root{--bg:#f0fbff;--card:#fff;--accent:#14b393;--muted:#666;}
  body{font-family:system-ui,-apple-system,"Segoe UI",Roboto,sans-serif;
       margin:0;padding:20px;background:linear-gradient(180deg,#eafffb,#f0fbff);}
  h1{font-size:1.6rem;margin:0 0 12px;color:var(--accent)}
  .top{display:flex;gap:12px;flex-wrap:wrap}
  .card{background:var(--card);border-radius:12px;box-shadow:0 6px 18px rgba(10,30,40,.08);
        padding:12px;min-width:260px;}
  label{display:block;font-size:.9rem;color:var(--muted);margin-bottom:6px}
  select,textarea,button{font-size:1rem;padding:8px;border-radius:8px;border:1px solid #ddd}
  button{background:var(--accent);color:white;border:none;cursor:pointer}
  button.secondary{background:#e6eef0;color:#123}
  .digit-sliders{display:flex;gap:12px;justify-content:center;margin:16px 0}
  .digit-wrap{display:flex;flex-direction:column;align-items:center;width:70px}
  .big-value{font-weight:700;font-size:1.4rem;margin:6px 0}
  input[type=range]{-webkit-appearance:none;width:100%;height:160px;writing-mode:bt-lr;
    transform:rotate(270deg);margin:20px 0;background:linear-gradient(90deg,#14b393,#6fd1c3);
    border-radius:10px;outline:none}
  #wheelCanvas{display:block;margin:16px auto;border-radius:12px}
  .footer{margin-top:12px;color:var(--muted);font-size:.9rem}
  .modal{position:fixed;left:0;top:0;width:100%;height:100%;display:none;
         align-items:center;justify-content:center;background:rgba(0,0,0,.4);z-index:40}
  .modal .dlg{background:#fff;padding:20px;border-radius:12px;text-align:center;min-width:260px}
  .confetti-canvas{position:fixed;left:0;top:0;pointer-events:none;z-index:30}
</style>
</head>
<body>
  <h1>LimiPlake PIN Picker</h1>
  <div class="top">
    <div class="card">
      <label>Classes</label>
      <select id="classSelect"></select>
      <label style="margin-top:8px">Edit PINs (one per line, 4 digits each)</label>
      <textarea id="pinsArea" placeholder="1234"></textarea>
      <div style="margin-top:6px;display:flex;gap:8px">
        <button id="savePins">Save</button>
        <button id="resetPins" class="secondary">Reset</button>
      </div>
    </div>

    <div class="card" style="flex:1;min-width:360px;">
      <label>Pick from Class</label>
      <select id="classForSpin"></select>

      <div class="digit-sliders">
        <div class="digit-wrap"><div class="big-value" id="vis0">-</div><input type="range" id="rng0" min="0" max="9" value="0"></div>
        <div class="digit-wrap"><div class="big-value" id="vis1">-</div><input type="range" id="rng1" min="0" max="9" value="0"></div>
        <div class="digit-wrap"><div class="big-value" id="vis2">-</div><input type="range" id="rng2" min="0" max="9" value="0"></div>
        <div class="digit-wrap"><div class="big-value" id="vis3">-</div><input type="range" id="rng3" min="0" max="9" value="0"></div>
      </div>

      <div style="text-align:center;">
        <button id="spinBtn">Spin!</button>
      </div>

      <canvas id="wheelCanvas" width="360" height="360"></canvas>
      <div class="footer">Winner is removed from class list after spin.</div>
    </div>
  </div>

  <div id="modal" class="modal">
    <div class="dlg">
      <h2>A LimiPoint to...</h2>
      <div id="modalWinner" style="font-size:1.8rem;font-weight:700;margin:10px 0"></div>
      <button id="closeModal">Close</button>
    </div>
  </div>
  <canvas id="confetti" class="confetti-canvas"></canvas>

<script>
const classes={"Class A":["1234","5678","4321"],"Class B":["2468","1357"]};
const classSelect=document.getElementById('classSelect');
const classForSpin=document.getElementById('classForSpin');
const pinsArea=document.getElementById('pinsArea');
const savePins=document.getElementById('savePins');
const resetPins=document.getElementById('resetPins');
const spinBtn=document.getElementById('spinBtn');
const rngs=[...Array(4)].map((_,i)=>document.getElementById('rng'+i));
const visuals=[...Array(4)].map((_,i)=>document.getElementById('vis'+i));
const modal=document.getElementById('modal'),modalWinner=document.getElementById('modalWinner');
document.getElementById('closeModal').onclick=()=>modal.style.display='none';
const wheelCanvas=document.getElementById('wheelCanvas'),wheelCtx=wheelCanvas.getContext('2d');
const confettiCanvas=document.getElementById('confetti'),confettiCtx=confettiCanvas.getContext('2d');
confettiCanvas.width=innerWidth;confettiCanvas.height=innerHeight;

// populate dropdowns
function populate(){[classSelect,classForSpin].forEach(sel=>{sel.innerHTML='';for(const k in classes){const o=document.createElement('option');o.value=k;o.textContent=k;sel.appendChild(o);}});loadPins();}
function loadPins(){const key=classSelect.value||Object.keys(classes)[0];pinsArea.value=(classes[key]||[]).join('\n');}
classSelect.onchange=loadPins;
savePins.onclick=()=>{const key=classSelect.value;classes[key]=pinsArea.value.split('\n').map(s=>s.trim()).filter(Boolean);populate();};
resetPins.onclick=()=>{const key=classSelect.value;classes[key]=["0000","1111","2222"];populate();};

// spin
function spin(){
  const key=classForSpin.value;let pins=classes[key]||[];if(pins.length===0){alert("No PINs!");return;}
  spinBtn.disabled=true;const winnerIndex=Math.floor(Math.random()*pins.length),winner=pins[winnerIndex];
  const digits=winner.split('').map(d=>+d);
  const durations=[2000,2500,3000,3500];const start=performance.now();
  function tick(now){
    const elapsed=now-start;
    rngs.forEach((r,i)=>{
      if(elapsed<durations[i]){r.value=(+r.value+1)%10;visuals[i].textContent=r.value;}
      else{r.value=digits[i];visuals[i].textContent=digits[i];}
    });
    if(elapsed<Math.max(...durations))requestAnimationFrame(tick);
    else{setTimeout(()=>{spinWheelToWinner(pins,winnerIndex,()=>{
      launchConfetti();modalWinner.textContent=winner;modal.style.display='flex';
      classes[key]=pins.filter((_,i)=>i!==winnerIndex);populate();spinBtn.disabled=false;});},400);}
  }
  requestAnimationFrame(tick);
}
spinBtn.onclick=spin;

// wheel
function drawWheel(items){const c=wheelCanvas,ctx=wheelCtx;ctx.clearRect(0,0,c.width,c.height);
  if(!items.length)return;const cx=c.width/2,cy=c.height/2,r=Math.min(cx,cy)-6;const slice=2*Math.PI/items.length;
  items.forEach((it,i)=>{const a=i*slice-Math.PI/2;ctx.beginPath();ctx.moveTo(cx,cy);ctx.arc(cx,cy,r,a,a+slice);ctx.closePath();ctx.fillStyle=i%2?'#fff':'#f7fffe';ctx.fill();ctx.strokeStyle='#ccc';ctx.stroke();
    ctx.save();ctx.translate(cx,cy);ctx.rotate(a+slice/2);ctx.textAlign='right';ctx.fillStyle='#123';ctx.font='14px sans-serif';ctx.fillText(it,r-10,6);ctx.restore();});
  ctx.fillStyle='var(--accent)';ctx.beginPath();ctx.moveTo(cx,6);ctx.lineTo(cx-12,26);ctx.lineTo(cx+12,26);ctx.closePath();ctx.fill();}
function spinWheelToWinner(items,winnerIndex,cb){
  const c=wheelCanvas,ctx=wheelCtx,cx=c.width/2,cy=c.height/2,r=Math.min(cx,cy)-6;
  const slice=2*Math.PI/items.length;const start=performance.now();const finalAngle=(winnerIndex+0.5)*slice;
  const endAngle=4*Math.PI*2+finalAngle;const duration=2500;
  function render(now){const t=(now-start)/duration;const ease=1-Math.pow(1-t,3);const current=endAngle*ease;
    ctx.clearRect(0,0,c.width,c.height);ctx.save();ctx.translate(cx,cy);ctx.rotate(-current);
    items.forEach((it,i)=>{const a=i*slice;ctx.beginPath();ctx.moveTo(0,0);ctx.arc(0,0,r,a,a+slice);ctx.closePath();ctx.fillStyle=i%2?'#fff':'#f7fffe';ctx.fill();ctx.strokeStyle='#ccc';ctx.stroke();
      ctx.save();ctx.rotate(a+slice/2);ctx.textAlign='right';ctx.fillStyle='#123';ctx.font='14px sans-serif';ctx.fillText(it,r-10,6);ctx.restore();});ctx.restore();
    ctx.fillStyle='var(--accent)';ctx.beginPath();ctx.moveTo(cx,6);ctx.lineTo(cx-12,26);ctx.lineTo(cx+12,26);ctx.closePath();ctx.fill();
    if(t<1)requestAnimationFrame(render);else if(cb)cb();}
  requestAnimationFrame(render);
}

// confetti
function launchConfetti(){const ctx=confettiCtx,w=confettiCanvas.width=innerWidth,h=confettiCanvas.height=innerHeight;
  const pieces=[];for(let i=0;i<120;i++){pieces.push({x:Math.random()*w,y:Math.random()*-h/2,vx:(Math.random()-.5)*6,vy:Math.random()*6+2,size:6+Math.random()*8,rot:Math.random()*Math.PI*2,color:`hsl(${Math.random()*360},80%,55%)`});}
  let f=0;function step(){ctx.clearRect(0,0,w,h);pieces.forEach(p=>{p.x+=p.vx;p.y+=p.vy;p.vy+=.12;p.rot+=.1;ctx.save();ctx.translate(p.x,p.y);ctx.rotate(p.rot);ctx.fillStyle=p.color;ctx.fillRect(-p.size/2,-p.size/2,p.size,p.size*.6);ctx.restore();});f++;if(f<180)requestAnimationFrame(step);}step();}
window.onresize=()=>{confettiCanvas.width=innerWidth;confettiCanvas.height=innerHeight;}
populate();drawWheel(classes[classForSpin.value||Object.keys(classes)[0]]);
</script>
</body>
</html>
