<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>LimiPlake PIN Picker</title>
<style>
  :root{--bg:#f0fbff;--card:#fff;--accent:#14b393;--muted:#666;}
  body{font-family:system-ui,-apple-system,"Segoe UI",Roboto,sans-serif;
       margin:0;padding:20px;background:linear-gradient(180deg,#eafffb,#f0fbff);}
  h1{font-size:1.6rem;margin:0 0 12px;color:var(--accent)}
  .top{display:flex;gap:12px;flex-wrap:wrap}
  .card{background:var(--card);border-radius:12px;box-shadow:0 6px 18px rgba(10,30,40,.08);
        padding:12px;min-width:260px;}
  label{display:block;font-size:.9rem;color:var(--muted);margin-bottom:6px}
  select,textarea,button{font-size:1rem;padding:8px;border-radius:8px;border:1px solid #ddd}
  button{background:var(--accent);color:white;border:none;cursor:pointer}
  button.secondary{background:#e6eef0;color:#123}
  .digit-sliders{display:flex;gap:12px;justify-content:center;margin:16px 0}
  .digit-wrap{display:flex;flex-direction:column;align-items:center;width:80px}
  .num{font-size:1.4rem;font-weight:700;margin-bottom:4px}
  input[type=range]{-webkit-appearance:none;width:100%;height:160px;writing-mode:bt-lr;
    transform:rotate(270deg);margin:10px 0;background:linear-gradient(90deg,#14b393,#14b393);
    border-radius:10px;outline:none}
  .shape-box{width:60px;height:40px;background:#14b393;color:white;font-size:1.8rem;
             display:flex;align-items:center;justify-content:center;border-radius:8px;margin-top:6px}
  .footer{margin-top:12px;color:var(--muted);font-size:.9rem}
  .modal{position:fixed;left:0;top:0;width:100%;height:100%;display:none;
         align-items:center;justify-content:center;background:rgba(0,0,0,.4);z-index:40}
  .modal .dlg{background:#fff;padding:20px;border-radius:12px;text-align:center;min-width:260px}
  .confetti-canvas{position:fixed;left:0;top:0;pointer-events:none;z-index:30}
</style>
</head>
<body>
  <h1>LimiPlake PIN Picker</h1>
  <div class="top">
    <div class="card">
      <label>Classes</label>
      <div style="display:flex;gap:6px;align-items:center;">
        <select id="classSelect" style="flex:1"></select>
        <button id="addClassBtn">+ Add Class</button>
      </div>
      <label style="margin-top:8px">Edit PINs (digits 1–4, 4 long)</label>
      <textarea id="pinsArea" placeholder="1234"></textarea>
      <div style="margin-top:6px;display:flex;gap:8px">
        <button id="savePins">Save</button>
        <button id="resetPins" class="secondary">Reset</button>
      </div>
    </div>

    <div class="card" style="flex:1;min-width:380px;">
      <label>Pick from Class</label>
      <select id="classForSpin"></select>

      <div class="digit-sliders">
        <div class="digit-wrap">
          <div class="num" id="num0">-</div>
          <input type="range" id="rng0" min="1" max="4" value="1">
          <div class="shape-box" id="shape0"></div>
        </div>
        <div class="digit-wrap">
          <div class="num" id="num1">-</div>
          <input type="range" id="rng1" min="1" max="4" value="1">
          <div class="shape-box" id="shape1"></div>
        </div>
        <div class="digit-wrap">
          <div class="num" id="num2">-</div>
          <input type="range" id="rng2" min="1" max="4" value="1">
          <div class="shape-box" id="shape2"></div>
        </div>
        <div class="digit-wrap">
          <div class="num" id="num3">-</div>
          <input type="range" id="rng3" min="1" max="4" value="1">
          <div class="shape-box" id="shape3"></div>
        </div>
      </div>

      <div style="text-align:center;">
        <button id="spinBtn">Spin!</button>
      </div>

      <div class="footer">Classes + PINs are auto-saved in your browser.</div>
    </div>
  </div>

  <div id="modal" class="modal">
    <div class="dlg">
      <h2>A LimiPoint to...</h2>
      <div id="modalWinner" style="font-size:1.6rem;font-weight:700;margin:10px 0"></div>
      <button id="closeModal">Close</button>
    </div>
  </div>
  <canvas id="confetti" class="confetti-canvas"></canvas>

<script>
// shape map
const shapes = {1:"⚪",2:"⬛",3:"◆",4:"▲"};
const classes={};
const classSelect=document.getElementById('classSelect');
const classForSpin=document.getElementById('classForSpin');
const pinsArea=document.getElementById('pinsArea');
const addClassBtn=document.getElementById('addClassBtn');
const savePins=document.getElementById('savePins');
const resetPins=document.getElementById('resetPins');
const spinBtn=document.getElementById('spinBtn');
const rngs=[...Array(4)].map((_,i)=>document.getElementById('rng'+i));
const numDisplays=[...Array(4)].map((_,i)=>document.getElementById('num'+i));
const shapeBoxes=[...Array(4)].map((_,i)=>document.getElementById('shape'+i));
const modal=document.getElementById('modal'),modalWinner=document.getElementById('modalWinner');
document.getElementById('closeModal').onclick=()=>modal.style.display='none';
const confettiCanvas=document.getElementById('confetti'),confettiCtx=confettiCanvas.getContext('2d');
confettiCanvas.width=innerWidth;confettiCanvas.height=innerHeight;

// localStorage helpers
function saveToLocal(){localStorage.setItem("limiplake-classes",JSON.stringify(classes));}
function loadFromLocal(){const data=localStorage.getItem("limiplake-classes");if(data)Object.assign(classes,JSON.parse(data));}

// update number + shape box
function setVisual(i,val){
  numDisplays[i].textContent=val;
  shapeBoxes[i].textContent=shapes[val];
}

// populate dropdowns
function populate(){
  [classSelect,classForSpin].forEach(sel=>{
    sel.innerHTML='';
    for(const k in classes){
      const o=document.createElement('option');
      o.value=k; o.textContent=k;
      sel.appendChild(o);
    }
  });
  loadPins();
  saveToLocal();
}
function loadPins(){
  const key=classSelect.value||Object.keys(classes)[0];
  if(!key)return;
  pinsArea.value=(classes[key]||[]).join('\n');
}
classSelect.onchange=loadPins;

// add class
addClassBtn.onclick=()=>{
  const name=prompt("Enter new class name:");
  if(!name)return;
  if(classes[name]){alert("That class already exists!");return;}
  classes[name]=[];
  populate();
  classSelect.value=name;classForSpin.value=name;
  loadPins();
};

// save pins
savePins.onclick=()=>{
  const key=classSelect.value;
  classes[key]=pinsArea.value.split('\n').map(s=>s.trim()).filter(Boolean);
  populate();
};

// reset pins
resetPins.onclick=()=>{
  const key=classSelect.value;
  classes[key]=["1234","2341","3412"];
  populate();
};

// spin logic
function spin(){
  const key=classForSpin.value;let pins=classes[key]||[];
  if(pins.length===0){alert("No PINs! Add some.");return;}
  spinBtn.disabled=true;
  const winnerIndex=Math.floor(Math.random()*pins.length);
  const winner=pins[winnerIndex];
  const digits=winner.split('').map(d=>+d);
  const durations=[2000,2500,3000,3500];const start=performance.now();
  function tick(now){
    const elapsed=now-start;
    rngs.forEach((r,i)=>{
      if(elapsed<durations[i]){
        let val=(+r.value%4)+1;
        r.value=val;setVisual(i,val);
      } else {r.value=digits[i];setVisual(i,digits[i]);}
    });
    if(elapsed<Math.max(...durations))requestAnimationFrame(tick);
    else{setTimeout(()=>{
      launchConfetti();
      modalWinner.textContent=winner.split('').map(d=>`${d}${shapes[d]}`).join(" ");
      modal.style.display='flex';
      classes[key]=pins.filter((_,i)=>i!==winnerIndex);
      populate();spinBtn.disabled=false;
    },400);}
  }
  requestAnimationFrame(tick);
}
spinBtn.onclick=spin;

// confetti
function launchConfetti(){
  const ctx=confettiCtx,w=confettiCanvas.width=innerWidth,h=confettiCanvas.height=innerHeight;
  const pieces=[];for(let i=0;i<120;i++){pieces.push({x:Math.random()*w,y:Math.random()*-h/2,
    vx:(Math.random()-.5)*6,vy:Math.random()*6+2,size:6+Math.random()*8,rot:Math.random()*Math.PI*2,
    color:`hsl(${Math.random()*360},80%,55%)`});}
  let f=0;function step(){ctx.clearRect(0,0,w,h);pieces.forEach(p=>{p.x+=p.vx;p.y+=p.vy;p.vy+=.12;p.rot+=.1;
    ctx.save();ctx.translate(p.x,p.y);ctx.rotate(p.rot);ctx.fillStyle=p.color;
    ctx.fillRect(-p.size/2,-p.size/2,p.size,p.size*.6);ctx.restore();});
    f++;if(f<180)requestAnimationFrame(step);}step();
}
window.onresize=()=>{confettiCanvas.width=innerWidth;confettiCanvas.height=innerHeight;}

// startup
loadFromLocal();
populate();
</script>
</body>
</html>
